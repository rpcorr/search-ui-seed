{"version":3,"sources":["./src/ui/AuthenticationProvider/AuthenticationProvider.ts","./sass/_AuthenticationProvider.scss"],"names":[],"mappings":"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","file":"AuthenticationProvider__d2b01b0f173a0c131e66.js","sourcesContent":["import { Component } from '../Base/Component';\nimport { ComponentOptions } from '../Base/ComponentOptions';\nimport { Assert } from '../../misc/Assert';\nimport { QueryEvents, IBuildingCallOptionsEventArgs, IQueryErrorEventArgs } from '../../events/QueryEvents';\nimport { IComponentBindings } from '../Base/ComponentBindings';\nimport { IInitializationEventArgs, InitializationEvents } from '../../events/InitializationEvents';\nimport { SettingsEvents } from '../../events/SettingsEvents';\nimport { ISettingsPopulateMenuArgs } from '../Settings/Settings';\nimport { DomUtils } from '../../utils/DomUtils';\nimport { $$ } from '../../utils/Dom';\nimport { Initialization } from '../Base/Initialization';\nimport { l } from '../../strings/Strings';\nimport { ModalBox } from '../../ExternalModulesShim';\nimport { MissingAuthenticationError } from '../../rest/MissingAuthenticationError';\nimport * as _ from 'underscore';\nimport { exportGlobally } from '../../GlobalExports';\nimport 'styling/_AuthenticationProvider';\nimport { SVGIcons } from '../../utils/SVGIcons';\nimport { HashUtils } from '../../utils/HashUtils';\nimport { QUERY_STATE_ATTRIBUTES } from '../../models/QueryStateModel';\nimport { SafeLocalStorage } from '../../utils/LocalStorageUtils';\n\nconst handshakeTokenParamName = 'handshake_token';\n\nexport interface IAuthenticationProviderOptions {\n  name?: string;\n  caption?: string;\n  useIFrame?: boolean;\n  showIFrame?: boolean;\n}\n\n/**\n * The `AuthenticationProvider` component makes it possible to execute queries with an identity that the end user\n * can obtain using an authentication provider configured on the Coveo REST Search API\n * (see [Claims Authentication](https://docs.coveo.com/en/113/)).\n *\n * When necessary, this component handles redirecting the browser to the address that starts the authentication process.\n *\n * You can use the `data-tab` attribute to enable the `AuthenticationProvider` component only for the tabs of your\n * search interface that require authentication (see the [`Tab`]{@link Tab} component).\n */\nexport class AuthenticationProvider extends Component {\n  static ID = 'AuthenticationProvider';\n  static handshakeInProgress = false;\n\n  static doExport = () => {\n    exportGlobally({\n      AuthenticationProvider: AuthenticationProvider\n    });\n  };\n\n  /**\n   * The options for the component.\n   * @componentOptions\n   */\n  static options: IAuthenticationProviderOptions = {\n    /**\n     * Specifies the name of the authentication provider.\n     *\n     * See [SAML Authentication](https://docs.coveo.com/en/91/).\n     */\n    name: ComponentOptions.buildStringOption(),\n\n    /**\n     * Specifies the display name of the authentication provider. This is the name that you want to appear in the user\n     * interface when the end user is logging in.\n     *\n     * Default value is the [`name`]{@link AuthenticationProvider.options.name} option value.\n     */\n    caption: ComponentOptions.buildStringOption({ postProcessing: (value, options) => value || options.name }),\n\n    /**\n     * Specifies whether to use an `<iframe>` to host the chain of redirection that make up the authentication\n     * process.\n     *\n     * Using an `<iframe>` prevents leaving the search page as part of the authentication process. However, some login\n     * providers refuse to load in an `<iframe>`.\n     *\n     * Default value is `false`.\n     */\n    useIFrame: ComponentOptions.buildBooleanOption({\n      defaultValue: false,\n      alias: ['useIframe']\n    }),\n\n    /**\n     * If the [`useIFrame`]{@link AuthenticationProvider.options.useIFrame} option is `true`, specifies whether to make\n     * the authentication `<iframe>` visible to the user (inside a popup).\n     *\n     * When the underlying authentication provider requires no user interaction (for example, when a user authenticates\n     * using Windows authentication along with SharePoint claims), setting this option to `false` reduces the visual\n     * impact of the authentication process.\n     *\n     * Default value is `true`.\n     */\n    showIFrame: ComponentOptions.buildBooleanOption({\n      defaultValue: true,\n      alias: ['showIframe'],\n      depend: 'useIFrame'\n    })\n  };\n\n  private handlers: ((...args: any[]) => void)[];\n  private redirectCount: number;\n  private storage = new SafeLocalStorage();\n\n  /**\n   * Creates a new `AuthenticationProvider` component.\n   * @param element The HTMLElement on which to instantiate the component.\n   * @param options The options for the `AuthenticationProvider` component.\n   * @param bindings The bindings that the component requires to function normally. If not set, these will be\n   * automatically resolved (with a slower execution time).\n   */\n  constructor(\n    public element: HTMLElement,\n    public options: IAuthenticationProviderOptions = {},\n    bindings?: IComponentBindings,\n    public _window?: Window\n  ) {\n    super(element, AuthenticationProvider.ID, bindings);\n\n    this.options = ComponentOptions.initComponentOptions(element, AuthenticationProvider, options);\n\n    Assert.exists(this.options.name);\n\n    this.handlers = [];\n\n    this._window = this._window || window;\n    this.redirectCount = 0;\n\n    this.bind.onRootElement(QueryEvents.buildingCallOptions, this.handleBuildingCallOptions);\n    this.bind.onRootElement(QueryEvents.queryError, this.handleQueryError);\n    this.bind.onRootElement(InitializationEvents.nuke, this.handleNuke);\n    this.bind.onRootElement(InitializationEvents.afterComponentsInitialization, (args: IInitializationEventArgs) =>\n      this.onAfterComponentsInitialization(args)\n    );\n\n    this.bind.onRootElement(SettingsEvents.settingsPopulateMenu, (args: ISettingsPopulateMenuArgs) => {\n      args.menuData.push({\n        text: l('Reauthenticate', this.options.caption),\n        className: 'coveo-authentication-provider',\n        onOpen: () => this.authenticateWithProvider(),\n        svgIcon: SVGIcons.icons.dropdownAuthenticate,\n        svgIconClassName: 'coveo-authentication-provider-svg'\n      });\n    });\n  }\n\n  private getHandshakeTokenFromUrl() {\n    const hash = this.getHashAfterAdjustingForAngular();\n    const token = HashUtils.getValue(handshakeTokenParamName, hash);\n    return typeof token === 'string' ? token : '';\n  }\n\n  private getHashAfterAdjustingForAngular() {\n    const hash = HashUtils.getHash();\n    return this.isAngularHash ? `#${hash.slice(2)}` : hash;\n  }\n\n  private get isAngularHash() {\n    const rawHash = HashUtils.getHash();\n    return rawHash.indexOf('#/') === 0;\n  }\n\n  private onAfterComponentsInitialization(args: IInitializationEventArgs) {\n    if (AuthenticationProvider.handshakeInProgress) {\n      const promise = this.waitForHandshakeToFinish().then(() => this.loadAccessTokenFromStorage());\n\n      args.defer.push(promise);\n      return;\n    }\n\n    const handshakeToken = this.getHandshakeTokenFromUrl();\n\n    if (!handshakeToken) {\n      return this.loadAccessTokenFromStorage();\n    }\n\n    if (!this.shouldExchangeHandshakeToken) {\n      return;\n    }\n\n    this.enableHandshakeInProgressFlag();\n\n    const promise = this.exchangeHandshakeToken(handshakeToken)\n      .then(token => this.storeAccessToken(token))\n      .then(() => this.removeHandshakeTokenFromUrl())\n      .then(() => this.loadAccessTokenFromStorage())\n      .catch(e => this.logger.error(e))\n      .finally(() => this.disableHandshakeInProgressFlag());\n\n    args.defer.push(promise);\n  }\n\n  private get shouldExchangeHandshakeToken() {\n    const tabId = $$(this.element).getAttribute('data-tab');\n    const hash = HashUtils.getHash();\n    const activeTabId = HashUtils.getValue(QUERY_STATE_ATTRIBUTES.T, hash);\n    return !tabId || tabId === activeTabId;\n  }\n\n  private exchangeHandshakeToken(handshakeToken: string) {\n    const accessToken = this.getAccessTokenFromStorage();\n    const options = accessToken ? { handshakeToken, accessToken } : { handshakeToken };\n    return this.queryController.getEndpoint().exchangeHandshakeToken(options);\n  }\n\n  private storeAccessToken(accessToken: string) {\n    this.storage.setItem(this.accessTokenStorageKey, accessToken);\n  }\n\n  private get accessTokenStorageKey() {\n    const { organizationId } = this.queryController.getEndpoint().options.queryStringArguments;\n    return `coveo-auth-provider-access-token-${organizationId}`;\n  }\n\n  private waitForHandshakeToFinish() {\n    return new Promise(resolve => {\n      const interval = setInterval(() => {\n        if (AuthenticationProvider.handshakeInProgress) {\n          return;\n        }\n\n        clearInterval(interval);\n        resolve();\n      }, 100);\n    });\n  }\n\n  private enableHandshakeInProgressFlag() {\n    AuthenticationProvider.handshakeInProgress = true;\n  }\n\n  private disableHandshakeInProgressFlag() {\n    AuthenticationProvider.handshakeInProgress = false;\n  }\n\n  private removeHandshakeTokenFromUrl() {\n    const delimiter = `&`;\n    const hash = this.getHashAfterAdjustingForAngular();\n    const token = this.getHandshakeTokenFromUrl();\n    const handshakeEntry = `${handshakeTokenParamName}=${token}`;\n\n    const entries = hash.substr(1).split(delimiter);\n    const newHash = entries.filter(param => param !== handshakeEntry).join(delimiter);\n    const adjustedHash = this.isAngularHash ? `/${newHash}` : newHash;\n\n    this._window.history.replaceState(null, '', `#${adjustedHash}`);\n  }\n\n  private loadAccessTokenFromStorage() {\n    const token = this.getAccessTokenFromStorage();\n    token && this.queryController.getEndpoint().accessToken.updateToken(token);\n  }\n\n  private getAccessTokenFromStorage() {\n    return this.storage.getItem(this.accessTokenStorageKey);\n  }\n\n  private handleBuildingCallOptions(args: IBuildingCallOptionsEventArgs) {\n    args.options.authentication.push(this.options.name);\n  }\n\n  private handleQueryError(args: IQueryErrorEventArgs) {\n    const token = this.getAccessTokenFromStorage();\n    const shouldClearToken = this.shouldClearTokenFollowingErrorEvent(args);\n\n    if (token && shouldClearToken) {\n      this.storage.removeItem(this.accessTokenStorageKey);\n      this._window.location.reload();\n      return;\n    }\n\n    let missingAuthError = <MissingAuthenticationError>args.error;\n\n    if (\n      missingAuthError.isMissingAuthentication &&\n      missingAuthError.provider === this.options.name &&\n      this.redirectCount < 2 &&\n      this.redirectCount !== -1\n    ) {\n      ++this.redirectCount;\n      this.authenticateWithProvider();\n    } else {\n      this.logger.error('The AuthenticationProvider is in a redirect loop. This may be due to a back-end configuration problem.');\n      this.redirectCount = -1;\n    }\n  }\n\n  private shouldClearTokenFollowingErrorEvent(args: IQueryErrorEventArgs) {\n    const exceptions = ['InvalidTokenException', 'ExpiredTokenException', 'InvalidAuthenticationProviderException'];\n    const error = args.error.name;\n    return exceptions.indexOf(error) !== -1;\n  }\n\n  private authenticateWithProvider() {\n    this.options.useIFrame ? this.authenticateWithIFrame() : this.redirectToAuthenticationProvider();\n  }\n\n  private redirectToAuthenticationProvider() {\n    this.logger.info(`Redirecting to authentication provider ${this.options.name}`);\n    this._window.location.href = this.getAuthenticationProviderUriForRedirect();\n  }\n\n  private authenticateWithIFrame() {\n    this.logger.info(`Using iframe to retrieve authentication for provider ${this.options.name}`);\n\n    let iframe = $$('iframe', {\n      src: this.getAuthenticationProviderUriForIFrame()\n    }).el;\n\n    let modalbox: Coveo.ModalBox.ModalBox;\n    modalbox = this.options.showIFrame ? this.createPopupForVisibleIFrame(iframe) : this.createPopupForWaitMessage(iframe);\n\n    let handler = this.createHandler(modalbox, iframe);\n    $$(<any>this._window).one('message', handler);\n    this.handlers.push(handler);\n  }\n\n  private createHandler(modalbox: Coveo.ModalBox.ModalBox, iframe: HTMLElement): () => void {\n    return () => {\n      $$(iframe).detach();\n      this.logger.info(`Got authentication for provider ${this.options.name}; retrying query.`);\n      modalbox.close();\n      this.queryController.executeQuery();\n    };\n  }\n\n  private handleNuke() {\n    _.each(this.handlers, handler => $$(<any>this._window).off('message', handler));\n  }\n\n  private createPopupForWaitMessage(iframe: HTMLElement): Coveo.ModalBox.ModalBox {\n    let popup = $$(\n      'div',\n      {\n        className: 'coveo-waiting-for-authentication-popup'\n      },\n      DomUtils.getBasicLoadingAnimation()\n    ).el;\n\n    $$(iframe).hide();\n    document.body.appendChild(iframe);\n\n    ModalBox.open(popup, {\n      title: l('Authenticating', this.options.caption),\n      sizeMod: 'small',\n      body: this.searchInterface.options.modalContainer\n    });\n    return ModalBox;\n  }\n\n  private createPopupForVisibleIFrame(iframe: HTMLElement): Coveo.ModalBox.ModalBox {\n    $$(iframe).addClass('coveo-authentication-iframe');\n    let popup = $$('div', {}, iframe).el;\n\n    ModalBox.open(popup, {\n      title: l('Authenticating', this.options.caption),\n      className: 'coveo-authentication-popup',\n      sizeMod: 'big',\n      body: this.searchInterface.options.modalContainer\n    });\n    return ModalBox;\n  }\n\n  private getAuthenticationProviderUriForRedirect(): string {\n    return this.queryController.getEndpoint().getAuthenticationProviderUri(this.options.name, this._window.location.href, undefined);\n  }\n\n  private getAuthenticationProviderUriForIFrame(): string {\n    return this.queryController.getEndpoint().getAuthenticationProviderUri(this.options.name, undefined, 'success');\n  }\n}\n\nInitialization.registerAutoCreateComponent(AuthenticationProvider);\n\n\n\n// WEBPACK FOOTER //\n// ./src/ui/AuthenticationProvider/AuthenticationProvider.ts","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./sass/_AuthenticationProvider.scss\n// module id = 598\n// module chunks = 77 88"],"sourceRoot":""}